# River Connectivity Classification

This repository contains the training and evaluation code for the vision-transformer and ResNet models used in the **“A framework for river connectivity classification using temporal image processing and attention based neural networks”**, published in **ACM COMPASS 2025**. To view the complete code for the project, please visit the [eco_image](https://github.com/timothyjamesbecker/eco_image/tree/master) repository.

---

## Repository Structure

```
.
├── vision-transformer/
│   ├── vit_training_script.py
│   ├── vit_runner.py
│   ├── vit_model.py
│   ├── vit_helper.py
│   └── data.py
│
└── resnet/
├── resnet_training_script.py
├── resnet_runner.py
├── resnet_model.py
├── resnet_helper.py
└── data.py
```
---

## Usage

### Data Preparation

Place your site-based image folders under:

```
DATA/
├── image_data/flow_600_200/
│   ├── 1/
│   ├── 2/
│   └── … 
├── training_images_1_2/        # generated by data.py
└── testing_images_1_2/
```

Adjust the `USE_HIGH_RES` & `SPLIT_SIX_CATEGORIES` parameters and folder names if you want to run low-res (300×100) versions or split into six classes.


### Vision Transformer

#### Single Run

```bash
cd vision-transformer
python vit_helper.py 1024 2 5 \
  '[{"1":1.0,"2":1.0},{"1":1.2,"2":1.0}]' \
  10 20
```

Arguments:

1. **mlp\_size** (e.g. 1024)
2. **transformer\_count** (e.g. 2)
3. **linear\_count** (e.g. 5)
4. **class\_weights** JSON
5. **patch\_size** (e.g. 10)
6. **num\_attention\_heads** (e.g. 20)

#### Hyperparameter Testing

```bash
python vit_runner.py \
  --mlp_size 1024,2048 \
  --transformer_count 1,2 \
  --linear_count 3,4,5 \
  --class_weights '[{"1":1.0,"2":1.0},{"1":1.2,"2":1.0}]' \
  --patch_size 10,20 \
  --num_attention_heads 20,24,30
```

All results—weights, training/validation plots, confusion matrix, and logs—are saved under `../RESULTS/<run_folder>`.

---

### ResNet

#### Single Run

```bash
cd resnet
python resnet_helper.py \
  64 '[3,8,36,3]' 1 \
  '{"1":1.0,"2":1.0}' 40
```

Arguments:

1. **initial\_filters** (e.g. 64)
2. **blocks\_per\_stage** JSON list
3. **linear\_layer\_number**
4. **class\_weights** JSON
5. **batch\_size**

#### Hyperparameter Testing

```bash
python resnet_runner.py
```

By default, `resnet_runner.py` iterates over ResNet101, 50, 34, 18 architectures with fixed class weights. Modify `architectures` in that script to customize.

---
